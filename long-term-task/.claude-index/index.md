# Project Index: long-term-task

> Auto-generated by project-indexer | Last updated: 2026-02-09

## Project Overview

- **Type:** Python CLI Tool / Agent Skill
- **Languages:** Python (100%)
- **Framework:** argparse (CLI), pathlib (file management)
- **Entry Points:** `long_term_task.py`, `ltt` CLI command (`src/long_term_task/cli.py`)
- **Purpose:** Universal long-term task management skill supporting multi-agent collaboration

## Key Features

1. **Task Lifecycle Management** - Create, execute, pause, resume, delete tasks
2. **Progress Tracking** - Periodic progress reports, milestone notifications
3. **Multi-Agent Collaboration** - Subtask coordination, global whiteboard sharing
4. **Process Safety** - File locks, atomic writes, concurrent access support
5. **Fault Tolerance** - Orphan detection, exponential backoff retry, auto-recovery
6. **Dual Interface** - Python SDK + CLI (supports Claude Code and OpenClaw)
7. **Reporter System** - File, Webhook, Callback, and Subtask reporters

## Feature Map

### Core SDK (`src/long_term_task/`)
Entry: `src/long_term_task/__init__.py`
- Main package exports for task management infrastructure
- **Key exports:**
  - `TaskManager` - Create and manage tasks
  - `Reporter`, `FileReporter`, `WebhookReporter`, `CallbackReporter`, `SubtaskReporter` - Notification systems
  - `ProgressTracker` - Progress tracking and milestone reporting
  - `StateManager` - State management with file locking

### Task Management (`src/long_term_task/manager.py`)
Entry: `src/long_term_task/manager.py`
- High-level task CRUD operations and lifecycle management
- **Key exports:**
  - `TaskManager.__init__(work_dir)` - Initialize manager with work directory (default ~/.ltt)
  - `TaskManager.create_task(name, goals, schedule, report_interval_minutes, milestones, reporter_type, reporter_config, metadata)` - Create new task with configuration
  - `TaskManager.get_task(task_id)` - Retrieve task by ID
  - `TaskManager.list_tasks(status_filter)` - List all tasks with optional status filter
  - `TaskManager.delete_task(task_id, soft)` - Delete task (soft or hard delete)
  - `TaskManager.create_subtask(parent_id, goal)` - Create child task for multi-agent coordination

### CLI Interface (`src/long_term_task/cli.py`)
Entry: `src/long_term_task/cli.py`
- Command-line interface for task operations
- **Commands:**
  - `ltt create` - Create new task with goals, schedule, and reporting config
  - `ltt list` - List all tasks with optional status filter
  - `ltt status <task_id>` - Show task details and progress
  - `ltt exec <task_id> [--step]` - Execute task (full or step-by-step mode)
  - `ltt check <task_id>` - Check task status and recent events
  - `ltt pause <task_id>` - Pause running task
  - `ltt resume <task_id>` - Resume paused task
  - `ltt delete <task_id> [--hard]` - Delete task (soft or hard)

### Task Execution (`src/long_term_task/executor.py`)
Entry: `src/long_term_task/executor.py`
- Task execution engine with progress tracking and reporting
- **Key exports:**
  - `Executor.__init__(task_dir, reporter)` - Initialize executor with task directory and reporter
  - `Executor.execute(step_mode)` - Execute task in full or step-by-step mode
  - `Executor._execute_step(step_index)` - Execute a single task step
  - `Executor._handle_retry(error)` - Exponential backoff retry logic

### Progress Tracking (`src/long_term_task/progress.py`)
Entry: `src/long_term_task/progress.py`
- Progress calculation, milestone detection, time estimation
- **Key exports:**
  - `ProgressTracker.__init__(task_id, reporter, total_steps, milestones, report_interval_minutes)` - Initialize progress tracker
  - `ProgressTracker.report_progress(current_step, elapsed_seconds)` - Report current progress
  - `ProgressTracker.check_milestone(progress_percent)` - Check if milestone reached
  - `ProgressTracker.report_to_whiteboard(agent_id, data)` - Multi-agent whiteboard sharing
  - `ProgressTracker.estimate_remaining_time(progress_percent, elapsed_seconds)` - Time-to-completion estimation

### Reporter System (`src/long_term_task/reporter.py`)
Entry: `src/long_term_task/reporter.py`
- Abstract notification layer with multiple implementations
- **Key exports:**
  - `Reporter` - Abstract base class for all reporters
  - `FileReporter(task_dir)` - Writes events to state.json for polling
  - `WebhookReporter(url)` - HTTP POST callbacks for push notifications
  - `CallbackReporter(callback_fn)` - Python function callbacks (SDK only)
  - `SubtaskReporter(parent_task_id, parent_reporter)` - Bidirectional parent-child notifications

### State Management (`src/long_term_task/state.py`)
Entry: `src/long_term_task/state.py`
- Thread-safe state persistence with file locking
- **Key exports:**
  - `StateManager.__init__(task_dir)` - Initialize state manager for task directory
  - `StateManager.read()` - Read current state (with lock)
  - `StateManager.update(update_fn)` - Atomic state update
  - `StateManager.add_event(event_type, data)` - Append event to history
  - `StateManager.get_recent_events(limit)` - Retrieve recent N events

### Orphan Detection (`src/long_term_task/checker.py`)
Entry: `src/long_term_task/checker.py`
- Detects and recovers from executor failures
- **Key exports:**
  - `Checker.__init__(task_dir)` - Initialize checker for task directory
  - `Checker.check()` - Check for orphaned executors (no heartbeat)
  - `Checker.detect_orphan()` - Detect if executor is unresponsive
  - `Checker.mark_orphaned()` - Mark task as orphaned and emit event

### Task Model (`src/long_term_task/task.py`)
Entry: `src/long_term_task/task.py`
- Task data model and helper methods
- **Key exports:**
  - `Task.__init__(task_id, config, state)` - Task object constructor
  - `Task.progress_percent` - Current progress percentage (0-100)
  - `Task.current_goal` - Current step being executed
  - `Task.is_completed` - Whether task is complete
  - `Task.is_running` - Whether task is currently executing
  - `Task.get_recent_events(limit)` - Get recent task events

### Legacy CLI Entry (`long_term_task.py`)
Entry: `long_term_task.py`
- Legacy entry point for dialog-based task creation
- Integrates with scripts/ directory for interactive workflows
- **Commands:**
  - `create <type>` - Create task via dialog (types: project-dev, research, general)
  - `dialog <type>` - Start interactive dialog mode
  - `list` - List all tasks from memory/long-term-tasks/
  - `status <task_id>` - Show task status
  - `pause/resume/delete <task_id>` - Task lifecycle operations

## Module Dependencies

- `cli` → `manager`, `executor`, `checker`, `task` (CLI orchestrates all core modules)
- `manager` → `task`, `state`, `reporter` (manager uses state and reporter for task CRUD)
- `executor` → `state`, `reporter`, `progress` (executor tracks progress and reports events)
- `progress` → `reporter` (progress tracker emits milestone events)
- `checker` → `state` (checker reads state to detect orphans)
- `task` → `state` (task is a read-only view of state)
- `state` → (standalone, no internal dependencies - file locking and JSON persistence)
- `reporter` → (standalone abstract layer)
- Scripts (`dialog.py`, `task_manager.py`) → memory-based workflow (separate from core SDK)

## File Index

### src/long_term_task/ (Core SDK)
| File | Description | Key Exports |
|------|-------------|-------------|
| `__init__.py` | Package entry point | TaskManager, FileReporter, WebhookReporter, CallbackReporter, SubtaskReporter, ProgressTracker, StateManager |
| `manager.py` | Task lifecycle management | TaskManager.create_task(), get_task(), list_tasks(), delete_task(), create_subtask() |
| `cli.py` | CLI command interface | main() - handles create/list/status/exec/check/pause/resume/delete commands |
| `executor.py` | Task execution engine | Executor.execute(step_mode=False), _execute_step(), _handle_retry() |
| `progress.py` | Progress tracking and milestones | ProgressTracker.report_progress(), check_milestone(), report_to_whiteboard() |
| `reporter.py` | Notification abstraction | Reporter (base), FileReporter, WebhookReporter, CallbackReporter, SubtaskReporter |
| `state.py` | State management with locks | StateManager.read(), update(), add_event(), get_recent_events() |
| `checker.py` | Orphan detection | Checker.check(), detect_orphan(), mark_orphaned() |
| `task.py` | Task data model | Task class with progress_percent, current_goal, is_completed, is_running properties |

### scripts/ (Legacy Dialog Workflow)
| File | Description | Key Functions |
|------|-------------|---------------|
| `dialog.py` | Interactive task creation dialog | DialogEngine.start_dialog(task_type), process_dialog_answer() |
| `task_manager.py` | Memory-based task manager | create_task() - stores tasks in memory/long-term-tasks/ |
| `executor.py` | Legacy executor (dialog mode) | execute_task() for dialog-created tasks |
| `checker.py` | Legacy checker (dialog mode) | check_task() for dialog-created tasks |

### templates/
| File | Description |
|------|-------------|
| `question-sets/general.md` | Question template for general tasks |
| `question-sets/project-dev.md` | Question template for development projects |
| `question-sets/research.md` | Question template for research tasks |
| `task-template.md` | Markdown template for task documentation |

### memory/
| Directory | Description |
|-----------|-------------|
| `long-term-tasks/` | Storage for dialog-created tasks (index.md + task-{id}/ subdirs) |

### examples/
| File | Description |
|------|-------------|
| `example.py` | Usage examples showing task creation and cron registration |

### Root Files
| File | Description |
|------|-------------|
| `long_term_task.py` | Legacy CLI entry point (dialog mode) |
| `pyproject.toml` | Python package configuration with hatchling build system |
| `README.md` | Comprehensive documentation with SDK and CLI usage examples |
| `SKILL.md` | Skill documentation for agent integration (Claude Code, OpenClaw) |
| `.gitignore` | Git exclusions for Python projects |

## Architecture Notes

### Two Modes of Operation

1. **SDK Mode (Recommended for Claude Code)**
   - Import `TaskManager` from `long_term_task` package
   - Direct Python API for task creation and management
   - Tasks stored in `~/.ltt/tasks/` or custom work_dir
   - Full programmatic control over reporters and state

2. **CLI Mode (Recommended for OpenClaw)**
   - Use `ltt` command-line tool
   - Subprocess-friendly for agent execution
   - JSON output for easy parsing
   - Suitable for cron job integration

3. **Dialog Mode (Legacy)**
   - Entry point: `long_term_task.py`
   - Interactive multi-turn conversation
   - Uses scripts/ and memory/ directories
   - Separate from core SDK

### Event Types

| Event | Description | When Emitted |
|-------|-------------|--------------|
| `task_started` | Task execution began | Executor starts |
| `progress_periodic` | Periodic progress update | Every report_interval_minutes |
| `progress_milestone` | Milestone reached | 25%, 50%, 75%, 100% completed |
| `task_completed` | Task finished successfully | All goals completed |
| `task_failed_final` | Task failed after retries | Retry count exhausted |
| `executor_orphaned` | Executor lost contact | Checker detects no heartbeat |
| `whiteboard_update` | Multi-agent state update | Agent writes to whiteboard |

### Directory Structure

```
~/.ltt/                           (or custom work_dir)
├── index.json                    # Task registry
└── tasks/
    ├── task-abc12345/
    │   ├── config.json           # Task configuration
    │   ├── state.json            # Current state + event history
    │   ├── state.lock            # File lock for concurrent access
    │   └── whiteboard.json       # Multi-agent shared state
    └── task-def67890/
        └── ...
```

### Integration Examples

**Claude Code (Python SDK)**
```python
from long_term_task import TaskManager
manager = TaskManager(work_dir="./.ltt")
task = manager.create_task(name="data-processing", goals=["download", "clean", "analyze"])
# Agent reads task.progress_percent and decides when to notify user
```

**OpenClaw (CLI + Cron)**
```bash
# Create task
ltt create --name "hf-papers" --goals "下载,分析,总结" --interval 30
# Output: ID: abc12345

# Add cron job
cron add --schedule "0 9 * * *" --command "ltt exec abc12345 --step"

# Check status
ltt check abc12345 --json
```

## Usage Patterns

### Single-Agent Task
1. Create task with `manager.create_task()` or `ltt create`
2. Execute with `ltt exec <task_id>` (manual) or cron job (scheduled)
3. Read progress from `state.json` or `ltt check <task_id> --json`
4. Agent decides when to notify user based on events

### Multi-Agent Collaboration
1. Parent creates subtasks: `manager.create_subtask(parent_id, goal)`
2. Each agent executes its subtask independently
3. Agents share progress via `tracker.report_to_whiteboard(agent_id, data)`
4. Parent reads whiteboard to coordinate: `whiteboard.json`
5. SubtaskReporter sends bidirectional notifications

### Error Handling
- Executor retries failed steps with exponential backoff
- Checker detects orphaned executors (no heartbeat for threshold period)
- Agents can read `retry_count` from state to decide intervention

## Best Practices

1. **Choose the right mode**: SDK for programmatic control, CLI for subprocess/cron integration
2. **Set appropriate report_interval_minutes**: Short tasks (2-5 min), long tasks (30-120 min)
3. **Use step mode for granular control**: `ltt exec <task_id> --step` executes one goal at a time
4. **Monitor events, not just progress**: Different event types require different user notifications
5. **Clean up completed tasks**: Use `manager.delete_task(soft=True)` to archive old tasks
6. **Leverage whiteboard for coordination**: Essential for multi-agent scenarios
7. **Handle orphans gracefully**: Checker will detect, but agent should decide recovery strategy

## Related Documentation

- README.md - Installation, quick start, and examples
- SKILL.md - Agent integration guide (dialog workflows, cron setup, notification strategies)
- pyproject.toml - Package metadata and dependencies
- examples/example.py - Working code samples
